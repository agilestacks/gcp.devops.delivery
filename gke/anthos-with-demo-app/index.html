<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="GKE Sandbox #  Deploy with CloudShell  Description #  GKE Sandbox with Anthos Service Mesh, ingress controller, and demo application.
     List of the components used in this sandbox:
 GKE Cluster GKE Node Pool Anthos Service Mesh Anthos Ingress Gateway DNS Zone Record Online Boutique - Demo APP  Click Start to go through the installation instructions.
Prerequisites #    You must be logged into your GCP account."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="ASM with Demo App"><meta property="og:description" content="GKE Sandbox #  Deploy with CloudShell  Description #  GKE Sandbox with Anthos Service Mesh, ingress controller, and demo application.
     List of the components used in this sandbox:
 GKE Cluster GKE Node Pool Anthos Service Mesh Anthos Ingress Gateway DNS Zone Record Online Boutique - Demo APP  Click Start to go through the installation instructions.
Prerequisites #    You must be logged into your GCP account."><meta property="og:type" content="article"><meta property="og:url" content="http://google.devops.delivery/gke/anthos-with-demo-app/"><meta property="article:section" content="gke"><title>ASM with Demo App | GCP Support Sandboxes</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.82c5dbd23447cee0b4c2aa3ed08ce0961faa40e1fa370eee4f8c9f02e0d46b5f.css integrity="sha256-gsXb0jRHzuC0wqo+0Izglh+qQOH6Nw7uT4yfAuDUa18=" crossorigin=anonymous><script defer src=/flexsearch.min.js></script>
<script defer src=/en.search.min.105a36e87c8a51ff3a15e89a0118f29beedbe013e8e16e067f8be5b161db81e5.js integrity="sha256-EFo26HyKUf86FeiaARjym+7b4BPo4W4Gf4vlsWHbgeU=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>GCP Support Sandboxes</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><span>Cloud Composer</span><ul><li><a href=/composer/with-demo-app/>With Demo App</a></li></ul></li><li><span>Cloud SQL</span><ul><li><a href=/cloud-sql/with-load-test/>With Load Test</a></li></ul></li><li><span>GKE</span><ul><li><a href=/gke/just-gke/>Empty GKE</a></li><li><a href=/gke/with-demo-app/>With Demo App</a></li><li><a href=/gke/anthos-with-demo-app/ class=active>ASM with Demo App</a></li></ul></li><li><span>VM</span><ul><li><a href=/vm/php-web-server/>Web Server + PHP + Cloud SQL</a></li></ul></li></ul><ul><li><a href=https://github.com/agilestacks/google-stacks target=_blank rel=noopener>Github</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>ASM with Demo App</strong>
<label for=toc-control></label></div></header><article class=markdown><h1 id=gke-sandbox>GKE Sandbox
<a class=anchor href=#gke-sandbox>#</a></h1><a href="https://ssh.cloud.google.com/cloudshell/editor?cloudshell_image=gcr.io/superhub/cloud-shell&cloudshell_git_repo=https://github.com/agilestacks/google-stacks&cloudshell_tutorial=" target=_blank rel=noopener class=book-btn>Deploy with CloudShell</a><h2 id=description>Description
<a class=anchor href=#description>#</a></h2><p>GKE Sandbox with Anthos Service Mesh, ingress controller, and demo application.</p><figure style="padding:.25rem;margin:2rem 0"><img src=/images/gke-with-anthos.png width=400 height><figcaption><small></small></figcaption></figure><p>List of the components used in this sandbox:</p><ul><li><a href=https://github.com/agilestacks/google-components/tree/main/gke-gcloud><code>GKE Cluster</code></a></li><li><a href=https://github.com/agilestacks/google-components/tree/main/gke-gcloud-node-pool><code>GKE Node Pool</code></a></li><li><a href=https://github.com/agilestacks/google-components/tree/main/anthos-service-mesh><code>Anthos Service Mesh</code></a></li><li><a href=https://github.com/agilestacks/google-components/tree/main/anthos-ingress-gateway><code>Anthos Ingress Gateway</code></a></li><li><a href=https://github.com/agilestacks/google-components/tree/main/dns-zone-record-set><code>DNS Zone Record</code></a></li><li><a href=https://github.com/agilestacks/google-components/tree/main/online-boutique-app><code>Online Boutique - Demo APP</code></a></li></ul><p>Click <code>Start</code> to go through the installation instructions.</p><h2 id=prerequisites>Prerequisites
<a class=anchor href=#prerequisites>#</a></h2><ul><li><p>You must be logged into your GCP account.</p></li><li><p>Open the Google <code>cloudshell</code> using the following <a href="https://ssh.cloud.google.com/cloudshell/editor?cloudshell_git_repo=https://github.com/agilestacks/google-stacks&cloudshell_image=gcr.io/superhub/cloud-shell&cloudshell_tutorial=hub-anthos-with-demo-app.md">link</a> (if not already opened):</p></li></ul><p><em>NOTE: The next steps must be executed from within the <code>cloudshell</code></em></p><h2 id=configuration>Configuration
<a class=anchor href=#configuration>#</a></h2><p>Before you can deploy the sandbox we need to ask you for some information.</p><p>Please run the initialization command pointing to the <code>hub</code> manifest file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>hub stack init -f hub-anthos-with-demo-app.yaml
</span></span></code></pre></div><p>The command will ask you to enter the ID of your GCP project.</p><p>Some of the components create DNS records (for easier access to the provisioned services) and some of them also need a GCS bucket to store their states.
The tool (<code>hub cli</code>) we use to provision sandboxes itself produces a state file that must be uploaded to the cloud.
For simplicity, we can pre-create Cloud DNS Zone and GCS bucket in your GCP project with random names.</p><p>Please run the following command to configure the environment of pre-create the required cloud resources (Cloud DNS Zone and GCS bucket):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>hub stack configure
</span></span></code></pre></div><p>If any of the sandbox components would require additional configuration parameters, users will be asked to provide them.</p><p>Every <code>component</code> has a set of parameters (key-value pairs) such as GKE cluster name or number of nodes in a node pool.
Please explore <code>parameters</code> section of the <a href=https://github.com/agilestacks/google-stacks/blob/main/hub-anthos-with-demo-app.yaml><code>hub-anthos-with-demo-app.yaml</code></a> to see what parameters are available.
Any default value can be overridden.
To get more information on how the components are implemented refer to their README files.</p><h3 id=how-to-recover-the-configuration-of-an-existing-sandbox>How to recover the configuration of an existing sandbox?
<a class=anchor href=#how-to-recover-the-configuration-of-an-existing-sandbox>#</a></h3><p>Google Cloud Shell environments are ephemeral,
which means any files stored locally on the Cloud Shell machine will be lost when
the machine restarts.
Luckily, we store sandbox state files in the Cloud,
which means, if we lose a local state, we can always recover it from the Cloud.</p><p>Execute the following commands to recover a state of a sandbox:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>hub stack init -f hub-anthos-with-demo-app.yaml -s <span style=color:#f92672>{</span>GCS path to a state file of the sanbox<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>hub stack configure
</span></span></code></pre></div><p>Please browse GCS buckets in your project to find the right one by the convention below:</p><p>GCS path naming convention:</p><p><em>gs://{sandbox state bucket}/{stack dns name}/hub/hub.state</em></p><p>Example:</p><p><em>gs://superhub-superhub/overconfident-corvo-216.epam.devops.delivery/hub/hub.state</em></p><p>After state is recovered, you can undeploy or update your sandbox.</p><h2 id=stack-deployment>Stack Deployment
<a class=anchor href=#stack-deployment>#</a></h2><p>Run <code>hub stack deploy</code> to deploy the sandbox</p><p>Run <code>hub stack undeploy</code> to undeploy the sandbox</p><p>Run <code>hub stack deploy -c &lt;name-of-the-component></code> to deploy a specific component on the sandbox</p><p>Run <code>hub undeploy -c &lt;name-of-the-component></code> to undeploy a specific component on the sandbox</p><h2 id=parameters>Parameters
<a class=anchor href=#parameters>#</a></h2><p>TBD: List of sandbox params to override</p><h2 id=architecture-diagram>Architecture Diagram
<a class=anchor href=#architecture-diagram>#</a></h2><p><img src=/images/gke_asm_diagram.png alt="GKE Sandbox Architecture"></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(n){const e=window.getSelection(),t=document.createRange();t.selectNodeContents(n),e.removeAllRanges(),e.addRange(t)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div></main></body></html>